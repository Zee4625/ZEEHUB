-- ZeeZeron V11: THE ULTIMATE PERSISTENT EXECUTOR (FIXED COLORS)
-- Features: Syntax Highlighting, Line Numbers, Security Scan, History, Tabs, Minimize

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Cleanup total
pcall(function()
    if player.PlayerGui:FindFirstChild("ZeeZeronV11") then
        player.PlayerGui.ZeeZeronV11:Destroy()
    end
end)

local gui = Instance.new("ScreenGui")
gui.Name = "ZeeZeronV11"
gui.ResetOnSpawn = false
gui.Parent = player.PlayerGui

-- DATA STORAGE
local history = {} 

-- MAIN FRAME
local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 850, 0, 520)
main.Position = UDim2.new(0.5, -425, 0.5, -260)
main.BackgroundColor3 = Color3.fromRGB(11, 11, 11)
main.BorderSizePixel = 0
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 8)

local glow = Instance.new("UIStroke", main)
glow.Color = Color3.fromRGB(0, 255, 120)
glow.Thickness = 2
glow.Transparency = 0.3

-- TOP BAR
local topBar = Instance.new("Frame", main)
topBar.Size = UDim2.new(1, 0, 0, 45)
topBar.BackgroundTransparency = 1

local title = Instance.new("TextLabel", topBar)
title.Size = UDim2.new(0, 200, 1, 0)
title.Position = UDim2.new(0, 20, 0, 0)
title.Text = "ZeeZeron V11"
title.TextColor3 = Color3.fromRGB(0, 255, 120)
title.Font = Enum.Font.Code
title.TextSize = 19
title.TextXAlignment = Enum.TextXAlignment.Left
title.BackgroundTransparency = 1

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0, 40, 0, 40)
closeBtn.Position = UDim2.new(1, -45, 0, 2.5)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.fromRGB(255, 50, 50)
closeBtn.BackgroundTransparency = 1
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18

local miniBtn = Instance.new("TextButton", topBar)
miniBtn.Size = UDim2.new(0, 40, 0, 40)
miniBtn.Position = UDim2.new(1, -85, 0, 2.5)
miniBtn.Text = "-"
miniBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
miniBtn.BackgroundTransparency = 1
miniBtn.Font = Enum.Font.GothamBold
miniBtn.TextSize = 25

-- EDITOR AREA
local editorMain = Instance.new("Frame", main)
editorMain.Size = UDim2.new(1, -260, 1, -180)
editorMain.Position = UDim2.new(0, 245, 0, 80)
editorMain.BackgroundColor3 = Color3.fromRGB(7, 7, 7)
Instance.new("UICorner", editorMain)

local editorScroll = Instance.new("ScrollingFrame", editorMain)
editorScroll.Size = UDim2.new(1, -10, 1, -10)
editorScroll.Position = UDim2.new(0, 5, 0, 5)
editorScroll.BackgroundTransparency = 1
editorScroll.ScrollBarThickness = 3
editorScroll.CanvasSize = UDim2.new(3, 0, 15, 0)

local lineNumbers = Instance.new("TextLabel", editorScroll)
lineNumbers.Size = UDim2.new(0, 35, 1, 0)
lineNumbers.BackgroundTransparency = 1
lineNumbers.TextColor3 = Color3.fromRGB(255, 180, 50)
lineNumbers.Font = Enum.Font.Code
lineNumbers.TextSize = 14
lineNumbers.TextYAlignment = Enum.TextYAlignment.Top
lineNumbers.TextXAlignment = Enum.TextXAlignment.Right
lineNumbers.ZIndex = 2

local highlightLabel = Instance.new("TextLabel", editorScroll)
highlightLabel.Size = UDim2.new(1, -45, 1, 0)
highlightLabel.Position = UDim2.new(0, 45, 0, 0)
highlightLabel.BackgroundTransparency = 1
highlightLabel.RichText = true
highlightLabel.TextXAlignment = Enum.TextXAlignment.Left
highlightLabel.TextYAlignment = Enum.TextYAlignment.Top
highlightLabel.Font = Enum.Font.Code
highlightLabel.TextSize = 14
highlightLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
highlightLabel.ZIndex = 3

local editor = Instance.new("TextBox", editorScroll)
editor.Size = UDim2.new(1, -45, 1, 0)
editor.Position = UDim2.new(0, 45, 0, 0)
editor.BackgroundTransparency = 1
editor.TextColor3 = Color3.fromRGB(255, 255, 255)
editor.TextTransparency = 0.8 -- Transparență ridicată pentru a lăsa culorile să se vadă
editor.Font = Enum.Font.Code
editor.TextSize = 14
editor.MultiLine = true
editor.ClearTextOnFocus = false
editor.TextXAlignment = Enum.TextXAlignment.Left
editor.TextYAlignment = Enum.TextYAlignment.Top
editor.TextWrapped = false
editor.ZIndex = 4

-- SIDEBAR LOGS (HISTORY)
local folderZone = Instance.new("Frame", main)
folderZone.Size = UDim2.new(0, 180, 1, -100)
folderZone.Position = UDim2.new(0, 55, 0, 50)
folderZone.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
Instance.new("UICorner", folderZone)

local folderScroll = Instance.new("ScrollingFrame", folderZone)
folderScroll.Size = UDim2.new(1, -10, 1, -10)
folderScroll.Position = UDim2.new(0, 5, 0, 5)
folderScroll.BackgroundTransparency = 1
folderScroll.ScrollBarThickness = 2
local logLayout = Instance.new("UIListLayout", folderScroll)
logLayout.Padding = UDim.new(0, 5)

-- FOOTER PANEL (SCANNER)
local securityBar = Instance.new("Frame", main)
securityBar.Size = UDim2.new(1, -60, 0, 30)
securityBar.Position = UDim2.new(0, 55, 1, -35)
securityBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Instance.new("UICorner", securityBar)

local securityText = Instance.new("TextLabel", securityBar)
securityText.Size = UDim2.new(1, -20, 1, 0)
securityText.Position = UDim2.new(0, 10, 0, 0)
securityText.Text = "Security: Waiting for script..."
securityText.TextColor3 = Color3.fromRGB(150, 150, 150)
securityText.Font = Enum.Font.Code
securityText.TextSize = 12
securityText.BackgroundTransparency = 1
securityText.TextXAlignment = Enum.TextXAlignment.Left

-- REFIXED LOGIC: SYNTAX & COLORS
local function updateEditor()
    local text = editor.Text
    
    -- Update Line Numbers
    local _, lines = text:gsub("\n", "")
    local numStr = ""
    for i = 1, lines + 1 do numStr = numStr .. i .. "\n" end
    lineNumbers.Text = numStr

    -- Fix Colors Logic
    local highlighted = text:gsub("<", "&lt;"):gsub(">", "&gt;")
    
    -- Strings (Galben)
    highlighted = highlighted:gsub('"(.-)"', '<font color="rgb(255, 255, 100)">"%1"</font>')
    highlighted = highlighted:gsub("'(.-)'", '<font color="rgb(255, 255, 100)">\'%1\'</font>')

    -- Keywords (Roz)
    local keywords = {"local", "function", "if", "then", "else", "end", "return", "while", "for", "do", "nil", "true", "false", "and", "or", "not"}
    for _, word in pairs(keywords) do
        highlighted = highlighted:gsub("%f[%w]"..word.."%f[%W]", '<font color="rgb(255, 100, 255)">'..word..'</font>')
    end
    
    -- Built-ins (Albastru)
    highlighted = highlighted:gsub("game", '<font color="rgb(100, 200, 255)">game</font>')
    highlighted = highlighted:gsub("print", '<font color="rgb(100, 255, 200)">print</font>')
    highlighted = highlighted:gsub("task", '<font color="rgb(100, 200, 255)">task</font>')
    highlighted = highlighted:gsub("wait", '<font color="rgb(100, 200, 255)">wait</font>')

    highlightLabel.Text = highlighted
end
editor:GetPropertyChangedSignal("Text"):Connect(updateEditor)

-- HISTORY MANAGEMENT
local function updateFolder()
    for _, v in pairs(folderScroll:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    for i, code in ipairs(history) do
        local hFrame = Instance.new("Frame", folderScroll)
        hFrame.Size = UDim2.new(1, -5, 0, 30)
        hFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        Instance.new("UICorner", hFrame)

        local hBtn = Instance.new("TextButton", hFrame)
        hBtn.Size = UDim2.new(1, -30, 1, 0)
        hBtn.BackgroundTransparency = 1
        hBtn.Text = "Log_"..i
        hBtn.TextColor3 = Color3.fromRGB(0, 255, 120)
        hBtn.Font = Enum.Font.Code
        hBtn.TextSize = 11

        local delBtn = Instance.new("TextButton", hFrame)
        delBtn.Size = UDim2.new(0, 25, 0, 25)
        delBtn.Position = UDim2.new(1, -27, 0.5, -12)
        delBtn.Text = "x"
        delBtn.TextColor3 = Color3.fromRGB(255, 50, 50)
        delBtn.BackgroundTransparency = 1
        
        hBtn.MouseButton1Click:Connect(function() editor.Text = code end)
        delBtn.MouseButton1Click:Connect(function() table.remove(history, i) updateFolder() end)
    end
end

-- SCAN LOGIC
local function scanScript()
    local code = editor.Text
    if code:find("Zee4625/ZEEHUB") then
        securityText.Text = "Safety Score: 9/10 - Verdict: Trusted Hub"
        securityText.TextColor3 = Color3.fromRGB(0, 255, 120)
    elseif code:find("loadstring") and code:find("HttpGet") then
        securityText.Text = "Safety Score: 4/10 - Verdict: Dangerous loadstring"
        securityText.TextColor3 = Color3.fromRGB(255, 150, 0)
    else
        securityText.Text = "Safety Score: 10/10 - Verdict: Safe"
        securityText.TextColor3 = Color3.fromRGB(0, 255, 120)
    end
end

-- BUTTONS SETUP
local footer = Instance.new("Frame", main)
footer.Size = UDim2.new(1, -260, 0, 50)
footer.Position = UDim2.new(0, 245, 1, -90)
footer.BackgroundTransparency = 1

local function createBtn(text, x, color)
    local btn = Instance.new("TextButton", footer)
    btn.Size = UDim2.new(0, 100, 0, 35)
    btn.Position = UDim2.new(0, x, 0.5, -17)
    btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    btn.Text = text
    btn.TextColor3 = color
    btn.Font = Enum.Font.Code
    btn.TextSize = 11
    Instance.new("UICorner", btn)
    Instance.new("UIStroke", btn).Color = color
    return btn
end

local execBtn = createBtn("EXECUTE", 0, Color3.fromRGB(0, 255, 120))
local clearBtn = createBtn("CLEAR", 110, Color3.fromRGB(200, 200, 200))
local scanBtn = createBtn("SCAN", 220, Color3.fromRGB(0, 200, 255))

execBtn.MouseButton1Click:Connect(function()
    table.insert(history, 1, editor.Text)
    updateFolder()
    local func, err = loadstring(editor.Text)
    if func then task.spawn(func) end
end)

clearBtn.MouseButton1Click:Connect(function() editor.Text = "" end)
scanBtn.MouseButton1Click:Connect(scanScript)

-- MINIMIZE SYSTEM
local miniIcon = Instance.new("TextButton", gui)
miniIcon.Size = UDim2.new(0, 60, 0, 60)
miniIcon.Position = UDim2.new(0.9, 0, 0.8, 0)
miniIcon.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
miniIcon.Text = "Z"
miniIcon.TextColor3 = Color3.fromRGB(0, 255, 120)
miniIcon.Font = Enum.Font.Code
miniIcon.TextSize = 35
miniIcon.Visible = false
Instance.new("UICorner", miniIcon).CornerRadius = UDim.new(0, 10)
Instance.new("UIStroke", miniIcon).Color = Color3.fromRGB(0, 255, 120)

miniBtn.MouseButton1Click:Connect(function() main.Visible = false miniIcon.Visible = true end)
miniIcon.MouseButton1Click:Connect(function() main.Visible = true miniIcon.Visible = false end)
closeBtn.MouseButton1Click:Connect(function() gui:Destroy() end)

-- DRAG
local function drag(obj)
    local dragging, dStart, sPos
    obj.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true dStart = i.Position sPos = obj.Position end end)
    UIS.InputChanged:Connect(function(i) if dragging and i.UserInputType == Enum.MouseMovement then local d = i.Position - dStart obj.Position = UDim2.new(sPos.X.Scale, sPos.X.Offset+d.X, sPos.Y.Scale, sPos.Y.Offset+d.Y) end end)
    UIS.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
end
drag(main) drag(miniIcon)

updateEditor()
